# 技術的負債メモ (2026-02-11)

## 現状サマリ

ここ数回のリファクタリングで、UI構造の重複はかなり解消され、スタイルも Tailwind に集約できた。一方で、状態管理と画面遷移の責務がまだ1か所に集まりすぎており、将来的な画面分割に備えた設計が未整理。

## 最近の改善（事実）

- 共有ビューを `src/main/view.mbt` に切り出し（`app_header` / `word_display`）。
- `style.css` は `@theme` と最小のベース設定だけに削減。
- 画面側のクラスは Tailwind に集約し、arbitrary values を減らした。
- 漢字ワードは注釈付きにし、表示は `display` を使うよう変更。

## 現在残っている負債

- `Model` が肥大化しており、画面単位の責務が分離されていない。
- `update` が単一関数で分岐過多になりやすい。
- 入力処理とスコア更新が同一ロジックに混在しており、テストが組みにくい。
- `typing_session` の `None`/`Some` に依存した分岐が画面側に残り、状態遷移が暗黙的。
- IME/ペーストなど入力の特殊ケースに弱い設計のまま。

## 影響/リスク

- 画面追加や画面間の独立テストが難しい。
- UI変更が状態バグに波及しやすい。
- 入力まわりの仕様追加（IME、連続入力、ショートカット等）が重くなる。

## 改善の方向性（優先度順）

### 短期

- `Model` を画面単位に分割する方針を確定する。
- `update` の責務を分割し、入力処理・スコア更新・遷移判断を分離する。
- `typing_state` の生成をUI層から外し、純粋関数化する。

### 中期

- `Screen` ごとの `Model/Msg/update/view` を用意し、`main` は統合レイヤーにする。
- 画面遷移の方式を決定（Event 方式 or 親Msg方式）し、ルール化する。
- 入力イベントを「キー入力」「単語確定」「スペース確定」に分解する。

### 長期

- 入力状態遷移図のドキュメント化（`docs/design.md` へ整理）。
- スコア仕様の明文化と `Score` への責務移譲。

## メモ

- 画面分割を進める際は `rabbit-tea-examples/` の構成が参考になる。
- 共有ビューの追加は進んだので、次は状態・遷移設計の整理が主課題。
